# 实现自己的RPC框架

背景：面试官让实现一个RPC

## 一、准备工作

首先，在实现RPC框架之前，我们需要知道RPC框架中所需的技术是什么。让我们来分析一下RPC，RPC要实现的功能是我们在调用远程服务的时候要像本地调用一样，要是使用者能够透明的调用远程方法。（为了描述简单起见，后文一律用服务端来表示被调用端，用客户端来表示调用端）。

1. 网络通信问题y
2. 序列化知识
3. Java反射相关知识
4. JDK动态代理相关知识

- 网络通信问题

我们先不考虑网络的复杂性以及远程应用可能发生错误或者挂掉等问题，要在本地调用服务端方法，肯定需要让服务端知道我们要调用的是哪个类的哪个方法，所以我们需要了解的有在客户端和服务端建立通信的方法。这里有很多方式，Socket编程、Netty，Mina等框架都能实现。当然涉及了网络，我们也得清楚我们是选择BIO还是NIO，由于本篇着重点在RPC的实现而不是IO，所以后文在IO方面不再赘述，本文为了简单性，使用Java原生的Socket和BIO来实现相关功能。

- 序列化知识

由于传递方法的参数等可能要涉及到序列化和反序列化的问题，所以我们得掌握序列化相关的知识。序列换的实现方式也有很多，常用的Java序列化、json、xml等序列化等。当然，还有很多第三方框架如protostuf等都提供了很好用的序列化方法，在本文中，我们直接使用Java的ObjectInputStream和ObjectOutputStream来实现相关功能。

- Java反射相关知识

由于在客户端并没有其调用方法的实现，客户端只知道有其调用方法的接口，所以在调用过程中客户端只知道其要调用方法所属的接口和方法名称和参数表。所以其通过网络传输给服务端的也只有这些内容，而服务端需要通过接口和方法名称来实现相关方法的调用，这里就涉及到Java反射技术。而Java反射技术简单说起来是只要知道一个类就可以知道类的所有属性和方法的能力，当然反射说起来简单，想要用好却得花大力气。

- JDK动态代理相关知识

由于要让客户端透明地实现远程方法的调用，所以只能借用JDK动态代理的技术将调用的网络通信等相关内容隐藏起来。当然，JDK动态代理也是Java中的进阶知识，但是简单的说起来，其就是可以动态地在调用方法前后加入相关内容来实现我们需要的功能。



## 二、代码实现

见代码

